\documentclass[11pt]{article}

\usepackage{amsmath}
\usepackage{textcomp}
\usepackage[top=0.8in, bottom=0.8in, left=0.8in, right=0.8in]{geometry}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{subcaption}


% Add other packages here %


% Put your group number and names in the author field %
\title{\bf Excercise 4\\ Implementing a centralized Agent}
\author{Group 24: Benvenuti, Bronner}


% N.B.: The report should not be longer than 3 pages %


\begin{document}
\maketitle

\section{Solution Representation}

\subsection{Variables}
% Describe the variables used in your solution representation %
Our solution is encoded in a list of states (1 state per vehicle) that are then converted into plans. In each state we store the starting city of the vehicle and its other variables (carrying capacity and so on) and a list of the tasks assigned to him. The order in which he has to pickup and deliver those tasks depends on the position of the task inside the list.

Each task assigned to the vehicle is inserted twice into the list of tasks. When we convert the state to a plan, or compute the cost of the state, or verify that the vehicle doesn't carry too much weight for its capacity, we run through the list of tasks in order. The first time we encounter a task, we assign a pickup action. The second time, we assign a delivery action. 

\subsection{Constraints}
% Describe the constraints in your solution representation %
In our solution representation a task cannot be assigned to more than one vehicle. A vehicle also cannot carry more tasks than allowed by its carrying capacity.

To make sure of this, when we assign a new task to a vehicle we add it at the end of the task list. Which means that the vehicle will pickup and deliver all the other tasks assigned to him and only then take care of the new task. Before adding the task to the vehicle we also make sure that it doesn't weight more than the vehicle's carrying capacity. This way we can be sure that we are not giving too much weight to handle at once to a vehicle.

When we change the order in which the vehicle will pickup and deliver the task assigned to him, before validating the new order, we run through the list of tasks and make sure that he will not be carrying too much weight at any point.


\subsection{Objective function}
% Describe the function that you optimize %
Each state has a cost equals to the vehicle cost per kilometers multiplied by the total distance the vehicle will have to travel.

Our objective function is the sum of the cost of all the states.


\section{Stochastic optimization}

\subsection{Initial solution}
% Describe how you generate the initial solution %
We initialize our algorithm by assigning all the tasks to the vehicle with the highest carrying capacity. We assign them so that he will go pickup the first task, then go deliver it, then go pickup the second task, and so on.

\subsection{Generating neighbours}
% Describe how you generate neighbors %
At each iteration we generate 2 neighbours. The first one is generated by selecting a random vehicle who has 2 or more tasks assigned to him and then 2 different tasks in his tasks list and swapping them. 

The second way is done by removing a task from one vehicle and assigning it to another vehicle. We don't use this second neighbour generation method if there is only one vehicle.

\subsection{Stochastic optimization algorithm}
% Describe your stochastic optimization algorithm %
Once we have initialized the algorithm, we run a loop for a set amount of iterations. The loop can also terminate if we get too close to the plan timeout time.

In each iteration of the loop, we generate 2 neighbours. We then compute their cost. Then, with a probability p, we go to the neighbour with the smallest cost. With a probability (1-p) we either stay in our current state or randomly pick one of the neighbours. This allows us to avoid being trapped into local minima. We keep track of our best solution and return it once the loop terminate, either because it has done all its iterations or because it terminates early to avoid a timeout error.

\section{Results}

\subsection{Experiment 1: Model parameters}
% if your model has parameters, perform an experiment and analyze the results for different parameter values %

\subsubsection{Setting}
% Describe the settings of your experiment: topology, task configuration, number of tasks, number of vehicles, etc. %
% and the parameters you are analyzing %
The settings of this experiment are the following: topology is "england", the task configuration has a distribution constant with a policy of short distance. There are ten tasks and four vehicles, all of them with the same capacity and cost per kilometer. Two parameters will be tested the number p which is the probability of taking the result of "ChooseNeighbours" and nbStep, the number of times the "ChooseNeighbours" is called. Two metrics will be used the cost of the total transportation and the time taken for all tasks to be delivered. 

The results are displayed in Table \ref{tab:1}.
\begin{table}
  \begin{center}
    \begin{tabular}{ | l | l | l | l |}
    \hline
    p & nbStep & Mean Cost & Mean Time taken \\ \hline
    0.3 & 10 & 24720 & 4060\\ \hline
    0.3 & 100 & 24497 & 3310 \\ \hline
    0.3 & 10000 & 26284 & 3300 \\ \hline
    0.3 & 1000000 & 24207 & 3100 \\ \hline
    0.4 & 1000000 & 24913 & 3110 \\\hline
    0.5 & 1000000 & 26362 & 3890 \\\hline
    1.0 & 1000000 & 24133 & 3680 \\\hline

    
    \end{tabular}
    \caption{Results for different parameter values, the mean values have been obtained after 5 measurements}
    \label{tab:1}
\end{center}
\end{table}

    
    


\subsubsection{Observations}
% Describe the experimental results and the conclusions you inferred from these results %
At first we notice that the total cost does not change much. This cost only depends on the individual performance of the vehicles. And this algorithm is far from assuring an optimal solution.

The time taken to deliver all the tasks varies much more. It is proportional to the number of task the vehicle with the most has to transport. Therefore, if the tasks are equally allocated along the vehicles the time should be minimized. 


\subsection{Experiment 2: Different configurations}
% Run simulations for different configurations of the environment (i.e. different tasks and number of vehicles) %

\subsubsection{Setting}
% Describe the settings of your experiment: topology, task configuration, number of tasks, number of vehicles, etc. %
The two parameters p and nbStep are 0.3 and 1000000 which gave the best results previously. We now change the number of vehicles and the number of tasks in the world. The Table \ref{tab:2} shows the results.
\begin{table}
  \begin{center}
    \begin{tabular}{ | l | l | l | l | }
    \hline
    Nb tasks & Nb vehicules  & Mean Time taken & Mean Cost \\ \hline
    10 & 4 & 3300 & 24207 \\ \hline
    10 & 2 & 4550 & 23182 \\ \hline
    20 & 4 & 5690 & 45677 \\ \hline
    20 & 2 & 8120 & 40430 \\ \hline

    
    \end{tabular}
    \caption{Time taken to transport all the tasks in function of the number of tasks and the number of vehicles, the mean values have been obtained after 5 measurements}
    \label{tab:2}
\end{center}
\end{table}



\subsubsection{Observations}
% Describe the experimental results and the conclusions you inferred from these results %
% Reflect on the fairness of the optimal plans. Observe that optimality requires some vehicles to do more work than others. %
% How does the complexity of your algorithm depend on the number of vehicles and various sizes of the task set? %

The main result is the fact that the cost is smaller when the fleet of trucks is smaller. Also the time taken to transport all the tasks is not linear with the number of trucks. The time only increases by 40\% when the number of vehicles is divided by two.

This seems to indicate that each vehicle of a smaller fleet will have a more optimized path.
\end{document}
